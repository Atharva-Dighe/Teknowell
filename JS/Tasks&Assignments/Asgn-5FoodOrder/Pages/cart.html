<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="../CSS/foodOrderSystem.css">
</head>

<body id="cartPg">
    <h1>Items in Your Cart</h1>
    <ol id="billList"></ol>
    <h2 id="total"></h2>

    <script>
        
        const cartArray = JSON.parse(localStorage.getItem('arr'));
        console.log("Array retrived from Restaurant Page is : ", cartArray);

        const billList = document.getElementById('billList');
        const totalCost = document.getElementById('total');

        if (cartArray && cartArray.length > 0) 
        {
            let totalPrice = 0;
            const listItems = cartArray.map(item => 
            {
                totalPrice += item.TotalPrice;
                return `<li>${item.Name} - ‚Çπ${item.Price} x ${item.Quantity} = ‚Çπ${item.TotalPrice}</li>`;
            });
            billList.innerHTML = listItems.join('');
            total.innerText = `Total Amount: ‚Çπ${totalPrice}`;
        }
        else 
        {
            billList.innerHTML = "<li>Your cart is empty.</li>";
            totalAmount.innerText = "";
        }

    </script>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  async function payNow() {
    // 1. Get total from your cart
    const cartArray = JSON.parse(localStorage.getItem('arr'));
    let totalPrice = cartArray.reduce((acc, item) => acc + item.TotalPrice, 0);

    // 2. Create order from backend
    const response = await fetch("http://localhost:5000/create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount: totalPrice })
    });
    const order = await response.json();

    // 3. Open Razorpay checkout
    var options = {
      key: "rzp_test_R9YK7209hKJDcC", 
      amount: order.amount,
      currency: order.currency,
      name: "My Food App",
      description: "Order Payment",
      order_id: order.id,
      handler: async function (response) {
        // 4. Verify payment
        const verify = await fetch("http://localhost:5000/verify-payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(response)
        });
        const result = await verify.json();
        if (result.success) {
          alert("üéâ Payment Successful!");
        } else {
          alert("‚ùå Payment Verification Failed!");
        }
      },
      theme: { color: "#3399cc" }
    };
    const rzp = new Razorpay(options);
    rzp.open();
  }
</script>

<button onclick="payNow()">Pay Now</button>

</body>

</html>